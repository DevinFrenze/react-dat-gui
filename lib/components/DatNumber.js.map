{"version":3,"sources":["../../src/components/DatNumber.jsx"],"names":[],"mappings":"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","file":"DatNumber.js","sourcesContent":["import cx from 'classnames';\nimport clamp from 'lodash.clamp';\nimport result from 'lodash.result';\nimport isFinite from 'lodash.isfinite';\nimport isString from 'lodash.isstring';\nimport React, { PropTypes } from 'react';\n\nclass DatNumber extends React.Component {\n\n    static propTypes = {\n        id: PropTypes.string,\n        data: PropTypes.object,\n        path: PropTypes.string,\n        label: PropTypes.string,\n        liveUpdate: PropTypes.bool,\n        onUpdate: PropTypes.func,\n        _onUpdateValue: PropTypes.func,\n        _labelWidth: PropTypes.number,\n        min: PropTypes.number,\n        max: PropTypes.number,\n        step: PropTypes.number,\n    };\n\n    constructor(props, context) {\n        super(props, context);\n        this.handleChange = this.handleChange.bind(this);\n        this.handleFocus = this.handleFocus.bind(this);\n        this.handleBlur = this.handleBlur.bind(this);\n        this.handleKeyDown = this.handleKeyDown.bind(this);\n        this.handleMouseDown = this.handleMouseDown.bind(this);\n        this.handleMouseMove = this.handleMouseMove.bind(this);\n        this.handleMouseUp = this.handleMouseUp.bind(this);\n        this.state = {\n            value: 0,\n            isSliderActive: false,\n        };\n    }\n\n    componentWillMount() {\n        this.setState({\n            value: this.getValue()\n        });\n    }\n\n    componentWillReceiveProps(nextProps) {\n        this.setState({\n            value: this.getValue(nextProps)\n        });\n    }\n\n    shouldComponentUpdate(nextProps, nextState) {\n        return nextProps.id !== this.props.id ||\n               nextProps.path !== this.props.path ||\n               nextProps.label !== this.props.label ||\n               nextProps._labelWidth !== this.props._labelWidth ||\n               nextProps.min !== this.props.value ||\n               nextProps.max !== this.props.value ||\n               nextProps.step !== this.props.value ||\n               nextState.value !== this.state.value;\n    }\n\n    getValue(props = this.props) {\n        return this.applyConstraints(result(props.data, props.path));\n    }\n\n    toNumber(value) {\n        const float = parseFloat(value);\n        return isNaN(float) ? 0 : float;\n    }\n\n    applyConstraints(value) {\n        const { min, max, step } = this.props;\n        const [ hasMin, hasMax, hasStep ] = [ isFinite(min), isFinite(max), isFinite(step) ];\n        let [ isMin, isMax ] = [ false, false ];\n        value = this.toNumber(value);\n        if (hasMin && value <= min) {\n            value = min;\n            isMin = true;\n        }\n        if (hasMax && value >= max) {\n            value = max;\n            isMax = true;\n        }\n        if (!isMin && !isMax) {\n            if (hasStep && step !== 0) {\n                value = Math.round(value / step) * step;\n            }\n        }\n        return value;\n    }\n\n    handleChange(event) {\n        this.setState({ value: event.target.value });\n    }\n\n    handleFocus(event) {\n        document.addEventListener('keydown', this.handleKeyDown);\n    }\n\n    handleBlur(event) {\n        document.removeEventListener('keydown', this.handleKeyDown);\n        window.getSelection().removeAllRanges();\n        const value = this.applyConstraints(event.target.value);\n        this.setState({ value }, () => {\n            this.update();\n        });\n    }\n\n    handleKeyDown(event) {\n        const key = event.keyCode || event.which;\n        if (key === 13) {\n            const value = this.applyConstraints(this.state.value);\n            this.setState({ value }, () => {\n                this.update();\n            });\n        }\n    }\n\n    handleMouseDown(event) {\n        const value = this.getSliderValue(event);\n        this.setState({ value, isSliderActive: true }, () => {\n            this.props.liveUpdate && this.update();\n        });\n        window.addEventListener('mousemove', this.handleMouseMove);\n        window.addEventListener('mouseup', this.handleMouseUp);\n    }\n\n    handleMouseMove(event) {\n        const value = this.getSliderValue(event);\n        this.setState({ value }, () => {\n            this.props.liveUpdate && this.update();\n        });\n        event.preventDefault();\n    }\n\n    handleMouseUp(event) {\n        !this.props.liveUpdate && this.update();\n        this.setState({ isSliderActive: false });\n        window.removeEventListener('mousemove', this.handleMouseMove);\n        window.removeEventListener('mouseup', this.handleMouseUp);\n    }\n\n    getSliderValue(mouseEvent) {\n        const { min, max } = this.props;\n        const sliderRect = this.refs.slider.getBoundingClientRect();\n        const x = mouseEvent.pageX - sliderRect.left;\n        const w = sliderRect.width;\n        return this.applyConstraints(min + clamp(x / w, 0, 1) * (max - min));\n    }\n\n    update() {\n        const { value } = this.state;\n        this.props._onUpdateValue && this.props._onUpdateValue(this.props.path, value);\n        this.props.onUpdate && this.props.onUpdate(value);\n    }\n\n    render() {\n        const { id, min, max, _labelWidth } = this.props;\n        const { value, isSliderActive } = this.state;\n        const label = isString(this.props.label) ? this.props.label : this.props.path;\n        const hasSlider = isFinite(min) && isFinite(min);\n        const labelStyle = _labelWidth ? { width: `${_labelWidth}%` } : {};\n        const sliderStyle = _labelWidth ? { width: `${2 * (100 - _labelWidth) / 3}%` } : {};\n        const inputStyle = _labelWidth ? { width: `${hasSlider ? (100 - _labelWidth) / 3 : 100 - _labelWidth}%` } : {};\n        const sliderPercent = (this.applyConstraints(value) - min) * 100 / (max - min);\n        const sliderBarStyle = hasSlider ? { maxWidth: `${sliderPercent}%` } : {};\n        const sliderClassName = cx('slider', { 'is-active': isSliderActive })\n        const className = cx('cr', 'number', { 'has-slider': hasSlider });\n        return (\n            <li className={className}>\n                <label htmlFor={id} style={labelStyle}>{label}</label>\n                <div className={sliderClassName} style={sliderStyle} ref=\"slider\" onMouseDown={this.handleMouseDown}>\n                    <div className=\"slider-bar\" style={sliderBarStyle} />\n                </div>\n                <input\n                    type=\"text\"\n                    inputMode=\"numeric\"\n                    style={inputStyle}\n                    id={id}\n                    value={value}\n                    onChange={this.handleChange}\n                    onFocus={this.handleFocus}\n                    onBlur={this.handleBlur} />\n            </li>\n        );\n    }\n\n}\n\nexport default DatNumber;\n"]}